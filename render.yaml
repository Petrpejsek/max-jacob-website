services:
  - type: web
    name: max-jacob-website
    env: node
    # Install deps + ensure Playwright Chromium exists in production
    buildCommand: npm install && npx playwright install --with-deps chromium
    startCommand: npm start
    envVars:
      - key: NODE_ENV
        value: production
      # OOM Fix: Set heap limit to 460MB (leave 52MB for system on 512MB tier)
      # This prevents runaway memory growth and triggers GC more aggressively.
      # --expose-gc allows manual GC after heavy operations (optional).
      - key: NODE_OPTIONS
        value: "--max-old-space-size=460 --expose-gc"
      # OOM Fix: Disable full-page screenshots to save ~150MB (5-20MB per screenshot)
      # Set to "true" to re-enable if needed for specific audits.
      - key: ENABLE_FULLPAGE_SCREENSHOTS
        value: "false"
      # IMPORTANT: Secrets MUST be set in the Render dashboard (or your VPS env),
      # never committed to git.
      # Required:
      # - ADMIN_PASSWORD
      # - SESSION_SECRET
      # - OPENROUTER_API_KEY (for audits)
      # PORT je automaticky nastavený Renderem, nepotřebujeme ho explicitně nastavovat
    healthCheckPath: /health
    autoDeploy: true
